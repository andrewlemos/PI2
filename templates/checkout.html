{% extends 'base.html' %}

{% block title %}Finalizar Compra - Minha Loja{% endblock %}

{% block content %}
<h1 class="mb-4">Finalizar Compra</h1>

<div class="row">
    <div class="col-lg-8">
        <div class="card border-0 shadow-sm mb-4">
            <div class="card-header bg-white">
                <h5 class="mb-0">Itens do Carrinho</h5>
            </div>
            <div class="card-body">
                <div id="carrinho-itens">
                    <!-- Itens serão carregados via JavaScript -->
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Carregando...</span>
                        </div>
                        <p class="mt-2">Carregando itens do carrinho...</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-white">
                <h5 class="mb-0">Informações de Entrega</h5>
            </div>
            <div class="card-body">
                <form>
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="firstName" class="form-label">Nome</label>
                            <input type="text" class="form-control" id="firstName" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="lastName" class="form-label">Sobrenome</label>
                            <input type="text" class="form-control" id="lastName" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="email" class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>
                    
                    <div class="mb-3">
                        <label for="address" class="form-label">Endereço</label>
                        <input type="text" class="form-control" id="address" required>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label for="zipCode" class="form-label">CEP</label>
                            <input type="text" class="form-control" id="zipCode" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="city" class="form-label">Cidade</label>
                            <input type="text" class="form-control" id="city" required>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="state" class="form-label">Estado</label>
                            <select class="form-select" id="state" required>
                                <option value="">Selecione...</option>
                                <!-- Opções de estados -->
                            </select>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-lg-4">
        <div class="card border-0 shadow-sm sticky-top" style="top: 100px;">
            <div class="card-header bg-white">
                <h5 class="mb-0">Resumo do Pedido</h5>
            </div>
            <div class="card-body">
                <div id="resumo-pedido">
                    <div class="d-flex justify-content-between mb-2">
                        <span>Subtotal</span>
                        <span>R$ 0,00</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Frete</span>
                        <span>Grátis</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Desconto</span>
                        <span class="text-success">-R$ 0,00</span>
                    </div>
                    <hr>
                    <div class="d-flex justify-content-between mb-3">
                        <strong>Total</strong>
                        <strong>R$ 0,00</strong>
                    </div>
                </div>
                
                {% if user.is_authenticated %}
                <div class="d-grid gap-2">
                    <button id="finalizar-compra" class="btn btn-success btn-lg">
                        <i class="fas fa-lock me-2"></i>Finalizar Compra
                    </button>
                </div>
                {% else %}
                <div class="alert alert-warning">
                    <p class="mb-2">Você precisa estar logado para finalizar a compra.</p>
                    <a href="{% url 'account_login' %}?next={% url 'checkout' %}" class="btn btn-primary btn-sm">Fazer Login</a>
                </div>
                {% endif %}
                
                <div class="mt-3">
                    <p class="small text-muted">Ao finalizar a compra, você concorda com nossos <a href="#">termos e condições</a>.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Container para o botão do Mercado Pago -->
<div id="mercado-pago-btn" class="mt-3" style="display: none;"></div>

<script>
    // Em um cenário real, aqui você carregaria os itens do carrinho
    document.addEventListener('DOMContentLoaded', function() {
        // Simular carregamento de itens do carrinho
        setTimeout(function() {
            document.getElementById('carrinho-itens').innerHTML = `
                <div class="checkout-item">
                    <div class="d-flex">
                        <div class="flex-shrink-0">
                            <img src="https://via.placeholder.com/80" alt="Produto" class="rounded" width="80">
                        </div>
                        <div class="flex-grow-1 ms-3">
                            <h6 class="mb-1">Nome do Produto</h6>
                            <p class="text-muted mb-0">Quantidade: 1</p>
                        </div>
                        <div class="flex-shrink-0">
                            <strong>R$ 99,90</strong>
                        </div>
                    </div>
                </div>
            `;
            
            // Atualizar resumo
            document.querySelector('#resumo-pedido .d-flex:last-child strong:last-child').textContent = 'R$ 99,90';
        }, 1500);
    });
</script>
{% endblock %}